<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icons/maps-icons.html">

<dom-module id="paper-morph">
    <template>
        <style>
            :host{
                display: block;
                background-color: #FFFF00;
            }
            .morphClosed {
                display: block;
                width: 60px;
                height: 60px;
                position: fixed;
                background-color: #FF0000;
                right: 0;
                bottom: 10px;
                z-index: 10;
                border-radius: 50%;
                margin-right: 15px;
                -webkit-transition-duration: 0.2s;
                transition-duration: 0.2s;
            }
            .morphOpened{
                width: 100%;
                height: 75px;
                position: fixed;
                right: 0;
                bottom: 0px;
                border-radius: 0;
                margin-right: 0px;
            }
            .backClose{
                background-color: #000;
                opacity: 0.7;
                width: 100%;
                position: fixed;
                left: 0px;
                top: 0px;
                height: 100%;
                -webkit-transition-duration: 0.6s;
                transition-duration: 0.6s;
            }
            .icon{
                width: 35px;
                height: 35px;
                color: #FFF;
                display: block;
                margin: auto;
                top: 50%;
                transform: translateY(-50%); 
                -webkit-transition-duration: 0.6s;
                transition-duration: 0.6s;
            }
        </style>


        <div id="backClose"></div>

        <div class="morphClosed" id="morph">
            <iron-icon id="fabicon" class="icon" icon="{{icon}}"></iron-icon>            
            <content></content>
        </div>


    </template>

    <script>
        Polymer({

            is: 'paper-morph',

            properties: {
                open: {
                    type: Boolean,
                    value: false
                },
                icon: {
                    type: String,
                    value: "icons:add"
                }
            },
            ready: function(){
                this.listen(this.$.morph, 'tap', '_changeState');
            },
            _changeState: function(){
                if (!this.open) {                    
                    this._open();
                }else{                    
                    this._close();
                }
            },
            _open: function(){
                this.open = true;

                this.unlisten(this.$.morph, 'tap', '_changeState');
                this.listen(this.$.backClose, 'tap', '_changeState');

                this.$.morph.classList.add('morphOpened');
                this.$.backClose.classList.add('backClose');

                this.$.fabicon.style.display = "none";
                this.$.fabicon.style.opacity = 0;
            },
            _close: function(){
                this.open = false;

                this.listen(this.$.morph, 'tap', '_changeState');
                this.unlisten(this.$.backClose, 'tap', '_changeState');

                this.$.morph.classList.remove('morphOpened');
                this.$.backClose.classList.remove('backClose');

                
                this.$.fabicon.style.display = "block";
                setTimeout(()=> {this.$.fabicon.style.opacity = 1}, 300);
                


            }

        });
    </script>
</dom-module>
